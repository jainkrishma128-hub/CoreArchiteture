using CommonArchitecture.Application.DTOs;
using CommonArchitecture.Core.Entities;
using CommonArchitecture.Core.Interfaces;

namespace CommonArchitecture.Application.Services;

public interface IMenuService
{
 Task<MenuDto> CreateMenuAsync(CreateMenuRequest request);
}

public class MenuService : IMenuService
{
 private readonly IMenuRepository _menuRepository;
 private readonly IUnitOfWork _unitOfWork;

 public MenuService(IMenuRepository menuRepository, IUnitOfWork unitOfWork)
 {
 _menuRepository = menuRepository;
 _unitOfWork = unitOfWork;
 }

 public async Task<MenuDto> CreateMenuAsync(CreateMenuRequest request)
 {
 var menu = new Menu
 {
 Name = request.Name,
 Icon = request.Icon,
 Url = request.Url,
 ParentMenuId = request.ParentMenuId,
 DisplayOrder = request.DisplayOrder,
 IsActive = true,
 CreatedAt = DateTime.UtcNow
 };

 await _menuRepository.AddAsync(menu);
 await _unitOfWork.SaveChangesAsync();

 return new MenuDto
 {
 Id = menu.Id,
 Name = menu.Name,
 Icon = menu.Icon,
 Url = menu.Url,
 ParentMenuId = menu.ParentMenuId,
 DisplayOrder = menu.DisplayOrder,
 IsActive = menu.IsActive
 };
 }
}

// Small DTO for request
public record CreateMenuRequest(string Name, string Icon, string Url, int? ParentMenuId, int DisplayOrder);
